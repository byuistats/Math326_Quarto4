<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Math326 Notebook - ANOVA and the F-Test</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Math326 Notebook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-basics-of-design" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Basics of Design</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-basics-of-design">    
        <li>
    <a class="dropdown-item" href="./key_principles.html" rel="" target="">
 <span class="dropdown-text">Key Principles</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./research_objectives.html" rel="" target="">
 <span class="dropdown-text">Research Objectives</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./response_variable.html" rel="" target="">
 <span class="dropdown-text">Response Variable</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./experimental_units.html" rel="" target="">
 <span class="dropdown-text">Experimental Units</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sources_of_variances.html" rel="" target="">
 <span class="dropdown-text">Sources of Variation - Factors and Conditions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./randomization.html" rel="" target="">
 <span class="dropdown-text">Randomization</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-specific-designs" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Specific Designs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-specific-designs">    
        <li>
    <a class="dropdown-item" href="./BasicFactorial_intro.html" rel="" target="">
 <span class="dropdown-text">Basic Factorial Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./BasicFactorial_quarto_boat.html" rel="" target="">
 <span class="dropdown-text">BF[1]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./bf2.html" rel="" target="">
 <span class="dropdown-text">BF[2]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./bf3.html" rel="" target="">
 <span class="dropdown-text">BF[3+]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./block_intro.html" rel="" target="">
 <span class="dropdown-text">Blocking Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./cb1.html" rel="" target="">
 <span class="dropdown-text">CB[1]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ancova.html" rel="" target="">
 <span class="dropdown-text">ANCOVA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./latin_square.html" rel="" target="">
 <span class="dropdown-text">Latin Square</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./NestedFactor.html" rel="" target="">
 <span class="dropdown-text">Nested Factor (aka Split Plot/Repeated Measure) Designs</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-broad-topics" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Broad Topics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-broad-topics">    
        <li>
    <a class="dropdown-item" href="./factor_structure.html" rel="" target="">
 <span class="dropdown-text">Factor Structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./effects_model.html" rel="" target="">
 <span class="dropdown-text">Effects Model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Anova_F-test.html" rel="" target="">
 <span class="dropdown-text">ANOVA and the F-test</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./assumptions.html" rel="" target="">
 <span class="dropdown-text">Assumptions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./contrast.html" rel="" target="">
 <span class="dropdown-text">Contrasts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./multiple_comparisons.html" rel="" target="">
 <span class="dropdown-text">Multiple Comparisons</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./unbalanced.html" rel="" target="">
 <span class="dropdown-text">Unbalanced Datasets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Kruskal.html" rel="" target="">
 <span class="dropdown-text">ZPower??</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./LogisticRegression.html" rel="" target="">
 <span class="dropdown-text">ZRandom Factors??</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-instructions" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">R Instructions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r-instructions">    
        <li>
    <a class="dropdown-item" href="./DescribeData.html" rel="" target="">
 <span class="dropdown-text">Descriptive Summaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./diagnostics.html" rel="" target="">
 <span class="dropdown-text">Model diagnostics</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-datasets" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Datasets</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-datasets">    
        <li>
    <a class="dropdown-item" href="././Data/AnalysisRubric.html" rel="" target="">
 <span class="dropdown-text">XYZ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="././Data/StudentHousing.html" rel="" target="">
 <span class="dropdown-text">yadda yadda</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#other-analysis-tools" id="toc-other-analysis-tools" class="nav-link" data-scroll-target="#other-analysis-tools">Other Analysis Tools</a>
  <ul class="collapse">
  <li><a href="#multiple-t-tests" id="toc-multiple-t-tests" class="nav-link" data-scroll-target="#multiple-t-tests">Multiple t-tests</a></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression">Regression</a></li>
  </ul></li>
  <li><a href="#analysis-of-variance" id="toc-analysis-of-variance" class="nav-link" data-scroll-target="#analysis-of-variance">Analysis of Variance</a></li>
  <li><a href="#anova-f-test-a-variance-ratio" id="toc-anova-f-test-a-variance-ratio" class="nav-link" data-scroll-target="#anova-f-test-a-variance-ratio">ANOVA F-test: A Variance Ratio</a>
  <ul class="collapse">
  <li><a href="#mean-squares-ms" id="toc-mean-squares-ms" class="nav-link" data-scroll-target="#mean-squares-ms">Mean Squares (MS)</a></li>
  <li><a href="#sum-of-squares-ss" id="toc-sum-of-squares-ss" class="nav-link" data-scroll-target="#sum-of-squares-ss">Sum of Squares (SS)</a></li>
  <li><a href="#degrees-of-freedom" id="toc-degrees-of-freedom" class="nav-link" data-scroll-target="#degrees-of-freedom">Degrees of Freedom</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ANOVA and the F-Test</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level1 page-columns page-full">
<h1>Introduction</h1>
<p>With the effects model defined we will want to test whether the treatment factor(s) has a statistically significant effect on the response variable. In other words we are interested in testing the hypotheses:</p>
<p><span class="math display">\[
H_0: \alpha_1 = \alpha_2 = ... = 0
\]</span></p>
<p><span id="eq-hypotheses"><span class="math display">\[
H_a: \alpha_i \ne 0 \text{ for at least one i}
\tag{1}\]</span></span></p>
<p>Where <span class="math inline">\(\alpha_i\)</span> represents the effect of a factor level.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Testing whether the effects are all equal to each other is incomplete, you must include the zero. Since all level effects must sum to zero for a given factor, the only way all effects can be equal is if they are all zero.</p>
</div></div><p><strong>An</strong>alysis <strong>o</strong>f <strong>va</strong>riance (ANOVA) is a statistical technique that allows us to simultaneously test all factor level effects at the same time.</p>
<p>By the end of this section you should be able to state a hypothesis for each term in an ANOVA effects model, calculate and explain the meaning of all the pieces of an ANOVA summary table output, and use the ANOVA summary table to conduct a test of the stated hypothesis.</p>
</section>
<section id="other-analysis-tools" class="level1">
<h1>Other Analysis Tools</h1>
<section id="multiple-t-tests" class="level2">
<h2 class="anchored" data-anchor-id="multiple-t-tests">Multiple t-tests</h2>
<p>At this point it is reasonable to ask if we couldn’t arrive at the same conclusion by simply conducting multiple t-tests. For example, you could do a t-test for each factor level to determine if the effect is significantly different from zero. Or you might consider testing each combination of factor level effects to see if they are equal to each other.</p>
<p>The multiple t-test approach has a couple of a drawbacks. The first drawback is that it becomes a real burden to run, present and interpret a lot of tests if there are many levels to a factor. If there are only 3 or 4 factor levels and only 1 or 2 factors in the analysis, conducting many tests may simply be an annoyance. However, if many factors and/or many factor levels are involved the magnitude of tests may bog down your analysis.</p>
<p>The other main drawback of using multiple t-tests is more substantive and has to do with the probability of a Type I error. Suppose the treatment factor in our study has 3 levels. The null hypothesis associated with an ANOVA that tests all factor level effects simultaneously is:</p>
<p><span class="math display">\[
H_0: \alpha_1 = \alpha_2 =  \alpha_3 = 0
\]</span></p>
<p>Testing at a 0.05 significance level means there is a 0.05 probability we will incorrectly reject this null hypothesis (i.e.&nbsp;commit a Type I error). Conversely, there is 0.95 probability we will NOT commit a Type I error.</p>
<p>If we attempt to approach the problem by conducting multiple t-tests, we would test the following set of null hypotheses:</p>
<p><span class="math inline">\(H_0: \alpha_1 = 0\)</span> and <span class="math inline">\(H_0: \alpha_2 = 0\)</span> and <span class="math inline">\(H_0: \alpha_3 = 0\)</span>.</p>
<p>We may conduct each of these tests at the 0.05 significance level. Incorrectly rejecting the null hypothesis on any one of these tests would result in the same Type 1 error as incorrectly rejecting the null hypothesis of our ANOVA test of all the effects simultaneously.</p>
<p>So what is the probability of committing a Type 1 error in at least 1 of these 3 tests? The simplest way to find the probability of committing at least one Type 1 error in the 3 tests is to calculate <span class="math inline">\(1 – P(\text{no Type 1 errors in all three tests})\)</span>. As previously stated, the significance level (0.05) of each test represents the probability of a Type 1 error. Therefore, the probability of <em>not</em> committing a Type 1 error on each test is 0.95. If we treat the tests as independent, we can find the probability of NOT committing a Type 1 error in all of the tests by multiplying the probabilities:</p>
<p><span class="math display">\[
0.95 * 0.95 * 0.95 = 0.857
\]</span></p>
<p>We can subsequently find <span class="math inline">\(1-0.857 = .143\)</span> is the probability of committing a Type 1 error in at least one of the tests, assuming all the null hypotheses are true. This is often referred to as the family wise error rate. The Type 1 error probability (0.143) in this family of t-tests is almost 3 times higher than the ANOVA Type 1 probability of 0.05.</p>
<p>In summary, ANOVA allows us to keep the number of tests manageable and it greatly simplifies how Type 1 error is addressed.</p>
<p>If we consider a study with more than 1 factor, there are additional advantages of ANOVA. Unlike a multiple t-test approach, while testing one factor’s effects the ANOVA test can account for the other factors’ impact on the response. In this regard, ANOVA is similar to regression.</p>
</section>
<section id="regression" class="level2">
<h2 class="anchored" data-anchor-id="regression">Regression</h2>
<p>ANOVA and linear regression are more similar than they are different. ANOVA and linear regression each have their own vocabulary because they were developed under different circumstances. ANOVA was developed to deal with agricultural experiments where the independent variables were primarily categorical. Linear regression tends to be introduced as a tool to analyze data where independent variables are quantitative. Though the language and output associated with each technique may appear different on the surface, the underlying “math” (i.e.&nbsp;the linear algebra) for both techniques is identical. It is not uncommon to have a study where there are multiple quantitative independent variables and multiple categorical independent variables. Thus, the differences between the two lie more in the problems they tend to be applied to and the vocabulary of the researcher than in any meaningful difference in results.</p>
</section>
</section>
<section id="analysis-of-variance" class="level1">
<h1>Analysis of Variance</h1>
<p>Though ANOVA may seem intimidating at first, the underlying idea is relatively simple. If we want to determine if a factor has a significant effect on a response variable we can look at the variance, or spread, in the resulting data. Specifically, we will compare the spread <em>between</em> factor level means with the spread of observations <em>within</em> a factor level.</p>
<p><a href="#fig-xo-different">Figure&nbsp;1</a> illustrates some made up data for a very simple, generic example where there are just two factor levels: X and O.</p>
<div id="fig-xo-different" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/xo-different.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Factor level means are different</figcaption>
</figure>
</div>
<p>Each individual observation is represented by a black X or O above the number line. The factor level mean for each factor is in blue, plotted beneath the number line. It is apparent that the X factor level mean and the O factor level mean are statistically different. The spread between factor level means is quite large <em>relative</em> to the spread of observations within each factor level.</p>
<p>Now consider the case, in <a href="#fig-xo-same">Figure&nbsp;2</a>, where the spread between factor level means is quite small <em>relative</em> to the spread of observations within a factor level. This suggests that the difference in factor level means could just as easily be due to random chance as due to a real difference between factor levels.</p>
<div id="fig-xo-same" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/xo-same.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Factor level means are close</figcaption>
</figure>
</div>
<p>The same logic that helped us arrive at conclusions in <a href="#fig-xo-different">Figure&nbsp;1</a> and <a href="#fig-xo-same">Figure&nbsp;2</a> are used in ANOVA. The main difference is that we use a variance calculation instead of a visual assessment of spread. We will also employ formal hypothesis testing techniques.</p>
</section>
<section id="anova-f-test-a-variance-ratio" class="level1 page-columns page-full">
<h1>ANOVA F-test: A Variance Ratio</h1>
<p>To test the hypotheses in <a href="#eq-hypotheses">Equation&nbsp;1</a> we will compare the variation <em>between</em> factor level means to the variation of observations <em>within</em> a factor level. This ratio of variances follows an F distribution<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and is therefore called an <strong>F test statistic</strong>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
F statistic and p-value
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[
F = \frac{\text{Variation between factor level means}}{\text{Variation of individual observations within factor levels}}
\]</span></p>
</div>
</div>
<p>The F distribution is defined by 2 values for degrees of freedom. One degrees of freedom value for the variance estimate in the numerator, and another for the variance estimate in the denominator. The p-value for the ANOVA F-test is calculated as the area under the F distribution curve to the right of the F statistic, as shown in <a href="#fig-pvalue">Figure&nbsp;3</a> .</p>
<div id="fig-pvalue" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/p-value_example.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Example P-value calculation based on a F-statistic of 2.23 and an F distribution with 3 and 16 degrees of freedom</figcaption>
</figure>
</div>
<p>If the ratio of variances is large (as in <a href="#fig-xo-different">Figure&nbsp;1</a>), then we get a large F statistic and a small p-value. If the p-value is less than our chosen level of significance we conclude that at least one factor level effect is non-zero. On the other hand, as the F ratio gets smaller and approaches 1 (similar to <a href="#fig-xo-same">Figure&nbsp;2</a>) our p-value increases and we may have insufficient evidence to say that the treatment factor has an effect on the response.</p>
<p>An F-test is only performed on structural factors. A test of the grand mean is not interesting, and a test of the residual error factor does not make sense. In fact, doing an F test of the residual error factor is not possible since the mean square error is typically the denominator in our F statistic.</p>
<p>The question then follows, <strong>how do we estimate variation between factor levels and within factor levels?</strong></p>
<p>Similar to the way in which we were able to break down each observation into its component parts using the <a href="./effects_model.html">effects model</a>, we now want to break down the variability in the dataset into its component parts. We will estimate how much of the total variability in the dataset comes from each of the terms (or factors) in the effects model.</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>The effects model:</p>
<p><span class="math inline">\(y_\text{ij} = \mu + \alpha_i + \epsilon_\text{ij}\)</span></p>
</div></div><p>The breakdown of variability and the resulting F-statistic and p-value are often displayed in an ANOVA summary table. <a href="#tbl-blank-table">Table&nbsp;1</a> is a blank version of the ANOVA summary table with just 1 structural factor/treatment. This table is essentially a container to provide perspective about how variability in the dataset is allocated across factors.</p>
<div id="tbl-blank-table" class="anchored">
<table class="table">
<caption>Table&nbsp;1: Blank ANOVA summary table for an experiment with 1 treatment factor</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Source</th>
<th style="text-align: center;">df</th>
<th style="text-align: center;">SS</th>
<th style="text-align: center;">MS</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grand Mean</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Treatment Factor</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residual Error</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
<p>On the far left, we list out the factors in our study as sources of variability. We are working our way backwards through the calculations in the table. We started with a discussion of F statistics and p-values. Next is an explanation of Mean Squares. In the explanation we will see that mean squares is a function of the Sum of Squares and degrees of freedom. Then we explain how each of those is calculated, respectively.</p>
<section id="mean-squares-ms" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="mean-squares-ms">Mean Squares (MS)</h2>
<p>You can think of Mean Squares (MS) as synonymous with variance. The F statistic is a ratio of variances:</p>
<p><span class="math display">\[
F = \frac{\text{Variation between factor levels}}{\text{Variation within factor levels}} = \frac{\text{Mean squares of treatment factor means}}{\text{Mean squares of residual errors}}
\]</span></p>
<p>With this is mind, we can fill in the F column of the ANOVA table for Treatment Factor.</p>
<div id="tbl-blank-1" class="anchored">
<table class="table">
<caption>Table&nbsp;2: Blank ANOVA summary table for an experiment with 1 treatment factor</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 60%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Source</th>
<th style="text-align: center;">df</th>
<th style="text-align: center;">SS</th>
<th style="text-align: center;">MS</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grand Mean</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Treatment Factor</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(\frac{MS_\text{Treatment Factor}}{MS_\text{Residual Error}}\)</span></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residual Error</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
<p>To find the variation <strong>between</strong> factor level means, calculate the sample variance of factor level means and multiply it by the number of replicates in each factor level. (In the case of unbalanced data where you do not have the same number of replicates in each factor level, weighting by sample size is needed).</p>
<p>The Mean Squares of the residual error factor (i.e.&nbsp;Mean Squared Error, MSE) represents the <strong>within</strong> factor level variation. To calculate it you can find the sample variance within each factor level and then take the mean of those variances. (In the case of unbalanced data where you do not have the same number of replicates in each factor level, you would take a weighted average).</p>
<p><a href="#fig-between_within-1">Figure&nbsp;4 (a)</a> and <a href="#fig-between_within-2">Figure&nbsp;4 (b)</a> below show deviations necessary to calculate the between group and within group variance (or in other words the mean squares treatment and the mean squares error). The figures are based on data from an experiment with 3 factor levels. <a href="#fig-between_within-1">Figure&nbsp;4 (a)</a> shows variation <strong>between</strong> factor level means. It shows the factor level means plotted as blue lines and the grand mean as a red line. In this chart we see the deviation from each factor level mean to the grand mean represented as a gray dashed line. As mentioned above, the mean squares for treatment could be computed as the variance of the 3 factor level means<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, and multiplied by 15 (the number of replicates in each factor level).</p>
<div id="fig-between_within" class="cell column-page quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-between_within-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Anova_F-test_files/figure-html/fig-between_within-1.png" class="img-fluid figure-img" data-ref-parent="fig-between_within" width="672"></p>
<figcaption class="figure-caption">(a) Deviations to Get MS Treatment Factor</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-between_within-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Anova_F-test_files/figure-html/fig-between_within-2.png" class="img-fluid figure-img" data-ref-parent="fig-between_within" width="672"></p>
<figcaption class="figure-caption">(b) Deviations to Get MS Error</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Between Group vs.&nbsp;Within Group</figcaption><p></p>
</figure>
</div>
<p><a href="#fig-between_within-2">Figure&nbsp;4 (b)</a> shows variation <strong>within</strong> factor levels. Each point is plotted in a cluster according to the factor level it belongs to. The deviation from each point to its respective factor level mean is depicted with a gray dashed line. The mean square error could be computed by finding the sample variance within each group<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> and then taking the mean of those 3 variance estimates.</p>
<p>Thinking about things in this way is helpful to understand conceptually what is happening. However, the ANOVA summary table captures interim steps for calculating mean squares slightly different. Since <strong>Mean Squares is synonymous with variance</strong>, now is a good time to review the sample variance formula.</p>
<p><span id="eq-sample-variance"><span class="math display">\[
s^2 = \frac{\sum{(y_i - \bar{y})}^2}{n-1}
\tag{2}\]</span></span></p>
<p>Upon closer examination of <a href="#eq-sample-variance">Equation&nbsp;2</a> you can see that this formula is essentially a mean. In fact, you can think of variance as a mean of squared deviations (a.k.a. errors). Any mean is built using 2 parts:</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Recall that an effect is defined as a deviation from the mean.</p>
</div></div><ul>
<li>numerator: a sum or total</li>
<li>denominator: the number of pieces of information used to create the sum in the numerator</li>
</ul>
<p>Therefore, in a mean square calculation, the numerator is the sum of squares and the denominator is the degrees of freedom.</p>
<table class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 39%">
<col style="width: 38%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Source</th>
<th style="text-align: center;">df</th>
<th style="text-align: center;">SS</th>
<th style="text-align: center;">MS</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grand Mean</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Treatment Factor</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(\frac{SS_\text{Treatment Factor}}{df_\text{Treatment Factor}}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{MS_\text{Treatment Factor}}{MS_\text{Residual Error}}\)</span></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residual Error</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(\frac{SS_\text{Residual Error}}{df_\text{Residual Error}}\)</span></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</section>
<section id="sum-of-squares-ss" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="sum-of-squares-ss">Sum of Squares (SS)</h2>
<p>Let’s talk about the numerator first, this will be the sum of squared deviations, or <strong>Sum of Squares</strong> for short. The Sum of Squares (SS) is a measure of the total variability in a dataset. A naïve approach to calculating total variability in a dataset is to measure the distance from each value to the mean of the dataset. The problem with this approach is that those distance measures will always sum to zero.</p>
<p>To avoid this problem, statisticians square the distances before summing them. This results in a value that summarizes the total amount of spread in the dataset. This quantity, the Sum of Squares, is important and so it has its own column in the ANOVA summary table.</p>
<p>In the table below an equation for each factor’s SS is listed using terms from the factor effects model. We’ll walk through the meaning of each of those equations.</p>
<table class="table">
<colgroup>
<col style="width: 9%">
<col style="width: 2%">
<col style="width: 19%">
<col style="width: 32%">
<col style="width: 31%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Source</th>
<th style="text-align: center;">df</th>
<th style="text-align: center;">SS</th>
<th style="text-align: center;">MS</th>
<th style="text-align: center;">F</th>
<th style="text-align: center;">p-value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Grand Mean</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(n*\bar{y}_\text{..}^2\)</span></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Treatment Factor</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math display">\[ \sum (\hat{\alpha}_i^2*n_i)\]</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{SS_\text{Treatment Factor}}{df_\text{Treatment Factor}}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{MS_\text{Treatment Factor}}{MS_\text{Residual Error}}\)</span></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Residual Error</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math display">\[ \sum \hat{\epsilon}_\text{ij}^2 \]</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{SS_\text{Residual Error}}{df_\text{Residual Error}}\)</span></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"><span class="math inline">\(\sum y_\text{ij}^2\)</span></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>

<div class="no-row-height column-margin column-container"><div class="">
<p>A deviation from the mean can be thought of as an effect. That is why the symbols for factor effects are used in the SS column in the ANOVA summary table.</p>
</div></div><p>First, let’s review the factor effects model to better understand the equations in the SS column above.</p>
<p><span class="math display">\[
y_\text{ij} = \mu + \alpha_i + \epsilon_\text{ij}
\]</span></p>
<p>We can walk through each equation in the SS column, one by one.</p>
<ul>
<li>Grand Mean SS: <span class="math inline">\(\bar{y}_\text{..}\)</span> is the grand mean. Its value should be squared and then multiplied by <span class="math inline">\(n\)</span>, which is the total number of observations in the study.</li>
<li>Treatment Factor SS: Recall that <span class="math inline">\(\hat{\alpha}_i\)</span> is the estimated effect of each factor level. After squaring each effect, multiply it by the number of observations in that level, <span class="math inline">\(n_i\)</span>. Finally, the <span class="math inline">\(\sum\)</span> symbol means to add all those products together.</li>
<li>Residual Error SS: <span class="math inline">\(\hat\epsilon_\text{ij}\)</span> is the symbol for an observed residual. Each residual must be squared and then all those squared residuals are summed together.</li>
<li>Total SS: This is the sum of all the other sums of squares. Or it can be found by squaring each observed value and then adding up all those squared observations.</li>
</ul>
</section>
<section id="degrees-of-freedom" class="level2">
<h2 class="anchored" data-anchor-id="degrees-of-freedom">Degrees of Freedom</h2>
<p>Degrees of freedom can be thought of as the number of unique pieces of information that contributed to the variance estimate, mean squares.</p>
<div id="tip-degrees-of-freedom" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Degrees of Freedom
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>The number of unique pieces of information that contributed to the variance estimate.</strong></p>
</div>
</div>
<p>In our dataset we have a certain number of observations. All those observations can be used to estimate the variance in the dataset. But you will notice in <a href="#eq-sample-variance">Equation&nbsp;2</a> the data has already been used to estimate the grand mean (<span class="math inline">\(\bar{y}\)</span> estimates <span class="math inline">\(\mu\)</span>). In other words, before we can estimate the variance we must use the data to estimate the mean. Estimating the mean “uses up” one degree of freedom. This is why the denominator of the sample variance formula divides by <span class="math inline">\(n-1\)</span> instead of by <span class="math inline">\(n\)</span>.</p>
<p>For additional explanation, consider this simple example. There are three data points and you know that the mean of these 3 data points is 10. The value of the first data point could be any number, it is free to vary. The value of the second data point could also be any number, it is free to vary. The third number’s value is not free to vary. It is constrained by the fact that the mean of the 3 data points must be 10. The values of the first two datapoints will determine the value of the third under the constraint of a known (or estimated) mean.</p>
<p>The example described above is summarized in <a href="#tbl-df-example">Table&nbsp;3</a>. The first number is represented as an <span class="math inline">\(a\)</span> and the second number if represented with a <span class="math inline">\(b\)</span>.</p>
<div id="tbl-df-example" class="anchored">
<table class="table">
<caption>Table&nbsp;3: Only n-1 values are free to vary when the mean of the values is known</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 17%">
<col style="width: 36%">
<col style="width: 6%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">value 1</th>
<th style="text-align: center;">value 2</th>
<th style="text-align: center;">value 3</th>
<th style="text-align: center;"></th>
<th style="text-align: center;">Mean of 3 Values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">a</td>
<td style="text-align: center;">b</td>
<td style="text-align: center;"><span class="math inline">\(3*10 - (a+b)\)</span></td>
<td style="text-align: center;">-&gt;</td>
<td style="text-align: center;">10</td>
</tr>
<tr class="even">
<td style="text-align: center;">free to vary</td>
<td style="text-align: center;">free to vary</td>
<td style="text-align: center;">depends on other two values</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
</div>
<p>How does this apply to the analysis of variance? Initially you have <span class="math inline">\(n\)</span> observations, or in other words <span class="math inline">\(n\)</span> unique pieces of information that can be used to estimate variance of the dataset. As you try to break the dataset’s variance into its component pieces, you will need to reallocate the <span class="math inline">\(n\)</span> pieces of information to each factor (grand mean, treatment factor, residual error) for use in estimating each factor’s mean square. To paraphrase the law of the conservation of mass, “the number of observations can neither be created nor destroyed”. The sum of degrees of freedom for all the factors must equal the number of observations in the dataset.</p>
<p>We will reason through the degrees of freedom calculation for each of the 3 sources in the ANOVA table. Keep in mind, we are using the simplest experiment, just one treatment factor, to illustrate these concepts. In more complex designs, there will be additional factors listed in the “sources” column.</p>
<p>As was mentioned, every time we use the data to estimate a parameter we use a degree of freedom. Or in other words, every time we use the data to estimate a parameter we lose a degree of freedom for our mean square error estimate. To find the grand mean we average over all the values in the dataset; that uses up one degree of freedom because we have estimated one mean, the grand mean.</p>
<p>When calculating the <strong>degrees of freedom for the treatment factor</strong> you might be tempted to think that the degrees of freedom is equal to the number of factor levels because you have to estimate a mean for each level. But, remember the simple example depicted in figure <a href="#tbl-df-example">Table&nbsp;3</a>. Because I have already estimated the grand mean, the last factor level is not free to vary and therefore is not estimated directly. The mean of the last factor level will have to be a number that satisfies the constraint that the mean of all the factor level means is the grand mean.</p>
<p>Explained another way, consider the fact that all the factor level effects must sum to zero. If there are <span class="math inline">\(i\)</span> factor levels, you only need to estimate effects for <span class="math inline">\(i-1\)</span> levels. The last level’s effect is a function of the other factor level effects, it does not need to be estimated and therefore does not need a degree of freedom.</p>
<p>Finally, consider the <strong>residual error factor</strong>. The non-technical definition of the term residual means “left over”. The degrees of freedom for the residual error factor is whatever degrees of freedom are left over after calculating degrees of freedom for all other factors.</p>
<p>In summary, to estimate the degrees of freedom for a factor, start with its number of levels and then subtract the number of means that need to be calculated in order to calculate the factor’s level effects. That may sound a bit confusing, luckily the general rule states the exact same thing in a simpler, more understandable way.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
General rule to find degrees of freedom for a factor
</div>
</div>
<div class="callout-body-container callout-body">
<p><span class="math display">\[
\text{df} = \text{number of levels} - \text{sum of df of outside factors}
\]</span></p>
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>F is a random variable. This means we never know exactly what the value of F will be based on random selection/assignments. However, we do know that under the null hypothesis some values of F are more likely than others. Specifically, if the null hypothesis were true then values of 1 are more likely and large values tend to be less likely. The F distribution represents a probability distribution of the variance ratios. In a given study just one random sample is taken and one variance ratio (F) is calculated. However, a different selection of experimental units (or different assignment to factor levels) would result in different estimates of variances, and consequently different F statistics. The F distribution represents all possible F statistics under the null hypothesis that a factor has no significant effect.</p>
<p>When a treatment factor has no significant effect on the response variable, the expected F statistic is 1. This is because there are two sources of variability contributing to our estimate of the treatment factor variance: 1) variance in factor level means and 2) variance within a factor level. The denominator of the F statistic is simply the variance within a factor level (since each factor level has a slightly different variance, it is actually the average or pooled variance within factor levels). So the F statistic looks like this:</p>
<p><span class="math display">\[
F = \frac{\text{variance in factor level means} + \text{variance within factor levels}}{\text{variance within factor levels}}
\]</span></p>
<p>If there really is no significant effect across factor levels, then the variance in factor level means goes to zero and we are left with:</p>
<p><span class="math display">\[
F = \frac{\text{variance within factor levels}}{\text{variance within factor levels}} = 1
\]</span></p>
<p>The values for degrees of freedom affect the shape and the spread of the F distribution. Visit <a href="https://keisan.casio.com/exec/system/1180573185">this applet</a> to learn more and interact with the family of F distributions.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The variance would be calculated by squaring the deviations, summing them up and then dividing by the degrees of freedom, which is 2 in this case.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The variance is calculated by squaring the deviations, and then summing them together and dividing by the degrees of freedom, which in this case is 14 for each group.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>