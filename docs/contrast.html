<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Math326 Notebook - Contrasts</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Math326 Notebook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-basics-of-design" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Basics of Design</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-basics-of-design">    
        <li>
    <a class="dropdown-item" href="./key_principles.html">
 <span class="dropdown-text">Key Principles</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./research_objectives.html">
 <span class="dropdown-text">Research Objectives</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./response_variable.html">
 <span class="dropdown-text">Response Variable</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./experimental_units.html">
 <span class="dropdown-text">Experimental Units</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./sources_of_variances.html">
 <span class="dropdown-text">Sources of Variation - Factors and Conditions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./randomization.html">
 <span class="dropdown-text">Randomization</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-specific-designs" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Specific Designs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-specific-designs">    
        <li>
    <a class="dropdown-item" href="./BasicFactorial_intro.html">
 <span class="dropdown-text">Basic Factorial Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./BasicFactorial_quarto_boat.html">
 <span class="dropdown-text">BF[1]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./bf2.html">
 <span class="dropdown-text">BF[2]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./bf3.html">
 <span class="dropdown-text">BF[3+]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./block_intro.html">
 <span class="dropdown-text">Blocking Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./cb1.html">
 <span class="dropdown-text">CB[1]</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./ancova.html">
 <span class="dropdown-text">ANCOVA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./latin_square.html">
 <span class="dropdown-text">Latin Square</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./nested_intro.html">
 <span class="dropdown-text">Nested Factor Designs Intro</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./split_plot.html">
 <span class="dropdown-text">SP/RM[1,1]</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-broad-topics" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Broad Topics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-broad-topics">    
        <li>
    <a class="dropdown-item" href="./factor_structure.html">
 <span class="dropdown-text">Factor Structure</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./effects_model.html">
 <span class="dropdown-text">Effects Model</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./Anova_F-test.html">
 <span class="dropdown-text">ANOVA and the F-test</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./assumptions.html">
 <span class="dropdown-text">Assumptions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./contrast.html">
 <span class="dropdown-text">Contrasts</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./multiple_comparisons.html">
 <span class="dropdown-text">Multiple Comparisons</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./unbalanced.html">
 <span class="dropdown-text">Unbalanced Datasets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./random_v_fixed.html">
 <span class="dropdown-text">Random Factors and EMS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-instructions" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">R Instructions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r-instructions">    
        <li>
    <a class="dropdown-item" href="./DescribeData.html">
 <span class="dropdown-text">Descriptive Summaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./diagnostics.html">
 <span class="dropdown-text">Model diagnostics</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-datasets" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Datasets</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-datasets">    
        <li>
    <a class="dropdown-item" href="./data/data_for_class.zip">
 <span class="dropdown-text">Download Zip Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./data_for_class.html">
 <span class="dropdown-text">Data Page</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-a-contrast" id="toc-what-is-a-contrast" class="nav-link active" data-scroll-target="#what-is-a-contrast">What is a Contrast?</a></li>
  <li><a href="#testing-a-contrast" id="toc-testing-a-contrast" class="nav-link" data-scroll-target="#testing-a-contrast">Testing a Contrast</a>
  <ul>
  <li><a href="#t-test-for-pairwise-comparisons" id="toc-t-test-for-pairwise-comparisons" class="nav-link" data-scroll-target="#t-test-for-pairwise-comparisons">t-test for Pairwise Comparisons</a></li>
  <li><a href="#t-test-for-any-contrast" id="toc-t-test-for-any-contrast" class="nav-link" data-scroll-target="#t-test-for-any-contrast">t-test for Any Contrast</a></li>
  <li><a href="#f-test-vs.-t-test" id="toc-f-test-vs.-t-test" class="nav-link" data-scroll-target="#f-test-vs.-t-test">F-test vs.&nbsp;t-test</a></li>
  <li><a href="#r-instructions" id="toc-r-instructions" class="nav-link" data-scroll-target="#r-instructions">R Instructions</a></li>
  </ul></li>
  <li><a href="#othogonal-contrasts" id="toc-othogonal-contrasts" class="nav-link" data-scroll-target="#othogonal-contrasts">Othogonal Contrasts</a>
  <ul>
  <li><a href="#assess-orthogonality" id="toc-assess-orthogonality" class="nav-link" data-scroll-target="#assess-orthogonality">Assess Orthogonality</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Contrasts</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<script type="text/javascript">
 function showhide(id) {
    var e = document.getElementById(id);
    e.style.display = (e.style.display == 'block') ? 'none' : 'block';
 }
</script>
<section id="what-is-a-contrast" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="what-is-a-contrast">What is a Contrast?</h2>
<p>The ANOVA F test is considered an omnibus test, meaning it tests all the factor levels of a factor at once. If the test suggests the null hypothesis should be rejected it seems to give rise to more questions than answers. Specifically, you will want to know which factor levels are significantly different from which other factor levels.</p>
<p>Usually during the design of an experiment, the researcher has specific comparisons in mind that are of particular interest. For example, they may be interested in comparing treatment effects for two dosing levels. These pre-planned comparisons usually drive the experimental design. When it comes time for analysis, an omnibus F-test test may be skipped entirely in favor of jumping directly to the planned comparisons. Or, if the F-test finds statistical significance, the researcher may follow-up with focused post-hoc tests of specific factor levels.</p>
<p>When one factor level mean is compared to another, it is called a <strong>pairwise comparison, or simple contrasts</strong>. For example, in our toothbrush experiment we may be interested in comparing the oscillating brush to the control group (manual brush). Or we may be especially interested in comparing sonic to ultra sonic.</p>
<p>Less commonly, the comparison of interest may involve averages of two or more factor level means. This is most likely to occur when the factor levels lend themselves to natural groupings that may be of particular interest to compare. For example, we may want to compare the mean of the sonic and ultrasonic groups to the mean of the oscillating group. Another example might include a comparison of the average of all the “treatment” toothbrushes vs.&nbsp;the control group (manual). When an average across groups is involved, this is called a <strong>complex comparison</strong>, or linear <strong>contrast</strong>.</p>
<p>We can represent the null hypotheses of these 4 example contrasts as:</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Though contrast and comparison are technically synonomous, “comparison” most often refers to simple, pairwise comparisons; and “contrast” refers to complex comparisons.</p>
</div><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/contrast_venn.JPG" class="img-fluid figure-img"></p>
<figcaption>Venn Diagram</figcaption>
</figure>
</div>
</div></div>
<p><span class="math inline">\(\begin{aligned} H_0: \mu_\text{osc} - \mu_\text{man} = 0 \end{aligned}\)</span></p>
<p><span class="math inline">\(\begin{aligned} H_0: \mu_\text{sonic} - \mu_\text{ultra} = 0 \end{aligned}\)</span></p>
<p><span class="math inline">\(\begin{aligned} H_0: \mu_\text{osc} - \frac{\mu_\text{sonic} + \mu_\text{ultra}}{2} = 0 \end{aligned}\)</span></p>
<p><span class="math inline">\(\begin{aligned} H_0: \mu_\text{man} - \frac{\mu_\text{osc} + \mu_\text{sonic} + \mu_\text{ultra}}{3} = 0 \end{aligned}\)</span></p>
<p>The above hypotheses can all be expressed as a sum, where each factor level mean is multiplied by a coefficient. When a factor level is not a part of the hypotheses, it has a coefficient of zero.</p>
<div id="tbl-expanded" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-expanded-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Expanded Hypotheses
</figcaption>
<div aria-describedby="tbl-expanded-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Four Null Hypotheses</th>
<th>Left Hand Side of Hypotheses Expressed as a Sum of Means and Coefficients</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \mu_\text{man} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(-1*\mu_\text{man} + 1*\mu_\text{osc} + 0*\mu_\text{sonic} + 0*\mu_\text{ultra}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\begin{aligned}\mu_\text{sonic} - \mu_\text{ultra} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(0*\mu_\text{man} + 0*\mu_\text{osc} + 1*\mu_\text{sonic} + -1*\mu_\text{ultra}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \frac{\mu_\text{sonic} + \mu_\text{ultra}}{2} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(0*\mu_\text{man} + 1*\mu_\text{osc} + -\frac{1}{2}*\mu_\text{sonic} + -\frac{1}{2}*\mu_\text{ultra}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\begin{aligned}\mu_\text{man} - \frac{\mu_\text{osc} + \mu_\text{sonic} + \mu_\text{ultra}}{3} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(1*\mu_\text{man} + -\frac{1}{3}*\mu_\text{osc} + -\frac{1}{3}*\mu_\text{sonic} + -\frac{1}{3}*\mu_\text{ultra}\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The contents in the right column of <a href="#tbl-expanded" class="quarto-xref">Table&nbsp;1</a> are referred to as contrasts. We will use the symbol <span class="math inline">\(\psi\)</span> to represent the contrast. A contrast is formed by multiplying each factor level mean by a coefficient. Simply put, it is a weighted sum. The above hypotheses are all examples of valid contrasts. <strong>To be considered a valid contrast, the only restriction is that the sum of the coefficients must be zero.</strong> We will often write coefficients used in a contrast as a set, in curly braces as shown in <a href="#tbl-coefficients" class="quarto-xref">Table&nbsp;2</a>. Thinking of a contrast in terms of its set of coefficients is helpful for identifying orthogonality of contrasts. Also, when calculating/testing a contrast with software, you are required to input the set (or vector) of coefficients to define the contrast.</p>
<div id="tbl-coefficients" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Contrast Coefficients
</figcaption>
<div aria-describedby="tbl-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 38%">
<col style="width: 37%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th><span class="math inline">\(H_0\)</span></th>
<th>Contrast (<span class="math inline">\(\psi\)</span>) Tested in <span class="math inline">\(H_0\)</span></th>
<th>Set of Contrast Coefficients</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \mu_\text{man} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(-1*\mu_\text{man} + 1*\mu_\text{osc} + 0*\mu_\text{sonic} + 0*\mu_\text{ultra}\)</span></td>
<td><span class="math inline">\(\{ -1, 1, 0, 0 \}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\begin{aligned}\mu_\text{sonic} - \mu_\text{ultra} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(0*\mu_\text{man} + 0*\mu_\text{osc} + 1*\mu_\text{sonic} + -1*\mu_\text{ultra}\)</span></td>
<td><span class="math inline">\(\{ 0, 0, 1, -1 \}\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \frac{\mu_\text{sonic} + \mu_\text{ultra}}{2} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(0*\mu_\text{man} + 1*\mu_\text{osc} + -\frac{1}{2}*\mu_\text{sonic} + -\frac{1}{2}*\mu_\text{ultra}\)</span></td>
<td><span class="math inline">\(\{ 0, 1, -\frac{1}{2}, -\frac{1}{2} \}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\begin{aligned}\mu_\text{man} - \frac{\mu_\text{osc} + \mu_\text{sonic} + \mu_\text{ultra}}{3} = 0 \end{aligned}\)</span></td>
<td><span class="math inline">\(1*\mu_\text{man} + -\frac{1}{3}*\mu_\text{osc} + -\frac{1}{3}*\mu_\text{sonic} + -\frac{1}{3}*\mu_\text{ultra}\)</span></td>
<td><span class="math inline">\(\{ 1, -\frac{1}{3}, -\frac{1}{3}, -\frac{1}{3} \}\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>There are an infinite number of contrasts that could be tested. Realistically though, the contrasts that make sense to test are generally obvious and depend on your understanding/context of the experiment. Testing pairwise comparisons (i.e.&nbsp;simple contrasts where the coefficients are either -1, 0, or 1) is quite common; averaging across certain factor level means as part of the comparison is less common, but is still something you should be prepared to do. Contrasts can get quite complicated, especially for experiments with complicated designs. In this class though we will stick to relatively simple situations.</p>
</section>
<section id="testing-a-contrast" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="testing-a-contrast">Testing a Contrast</h2>
<section id="t-test-for-pairwise-comparisons" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="t-test-for-pairwise-comparisons">t-test for Pairwise Comparisons</h3>
<p>Pairwise comparisons (i.e.&nbsp;simple contrasts) of means using a t-test is something you are probably familiar with from previous statistics classes. The procedure was most likely called something like, “independent samples t-test of two means”. We can build on that understanding to come up with a more general approach that will allow us to test any contrast.</p>
<p>Recall, that a t-test for one sample has the general form:</p>
<p><span class="math display">\[
t = \frac{\bar{y} - \mu_0}{s_\bar{y}}
\]</span></p>
<p>Where <span class="math inline">\(\bar{y}\)</span> is the sample mean, <span class="math inline">\(\mu_0\)</span> is the value from the null hypothesis, and <span class="math inline">\(s_\bar{y}\)</span> is the standard error of the mean. We can expand this to test whether a difference of two means is zero, in other words an independent samples t-test of two means. Recall, that in ANOVA we assume constant variance across factor levels. (This is a slightly different assumption, resulting in a slightly different calculation than the independent samples t-tests presented in Math221 and Math325<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>).</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>Standard error of the mean is equal to standard deviation of the individual observations divided by square root of the sample size, <span class="math inline">\(s_\bar{y} = \frac{s_y}{\sqrt{n}}\)</span>. See <a href="https://byuistats.github.io/BYUI_M221_Book/Lesson06.html#mean-and-standard-deviation-of-the-distribution-of-sample-means">Math221 text</a> for review.</p>
</div></div><p>In our toothbrush experiment, if we want to test whether the mean of manual brushes is equal to the mean of oscillating brushes we have for our null hypothesis:</p>
<p><span class="math display">\[
H_0: \mu_\text{man} - \mu_\text{osc} = 0
\]</span></p>
<p>We use a t statistic:</p>
<p><span id="eq-diff2means"><span class="math display">\[
t = \frac{(\bar{y}_\text{man} - \bar{y}_\text{osc})}{\sqrt{s^2_p*(\frac{1}{n_1} + \frac{1}{n_2})}}
\tag{1}\]</span></span></p>
<p>The difference in the numerator is calculated directly from the contrast (multiplying the set of coefficients by their respective factor level mean). In the denominator, the pooled variance (<span class="math inline">\(s^2_p\)</span>) is identical to the mean squared error from the ANOVA summary table. The degrees of freedom for this t-test statistic are equal to the residual degrees of freedom.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Note, by using the MSE from the ANOVA summary table we are taking advantage of information about residual errors contained in the observations of sonic and ultrasonic brushes as well as the observations from manual and oscillating. This leads to a better estimate of the size of random error.</p>
</div>
</div>
</div>
<p>For our study on toothbrushes we have the model:</p>
<p><span id="eq-model1"><span class="math display">\[
y_\text{ij} = \mu + \alpha_i + \epsilon_\text{ij}
\tag{2}\]</span></span></p>
<p>Where</p>
<ul>
<li><span class="math inline">\(y_\text{ij}\)</span> is an observation</li>
<li><span class="math inline">\(\mu\)</span> is the grand mean</li>
<li><span class="math inline">\(\alpha_i\)</span> represents the effect of factor level <span class="math inline">\(i\)</span></li>
<li><span class="math inline">\(\epsilon_\text{ij}\)</span> is the residual error for the <span class="math inline">\(j^\text{th}\)</span> observation in factor level <span class="math inline">\(i\)</span></li>
</ul>
<p>Below is the table of factor level means and the ANOVA summary table.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: tbl-brush_analysis</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Toothbrush Experiment Results"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-subcap:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="in">#| - "Factor Level Means"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="in">#| - "ANOVA Summary Table"</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="in">#| layout-ncol: 2</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="in">bf2 &lt;- read_csv("data/toothpaste_BF2.csv") </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="in">means_tbl &lt;- bf2 |&gt; group_by(Brush) |&gt; summarise(mean = mean(Plaque),</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="in">                                    `sample size` = n())</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="in">means_tbl |&gt; pander::pander()</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="in">brush_aov &lt;- aov(Plaque~Brush, data = bf2)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="in">summary(brush_aov) |&gt; pander::pander()</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="in">#These lines store values in variables so that I can write them in</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="in">#the latex equation below programmatically rather than hardcoding them</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="in">mean_man &lt;- means_tbl[[1,2]]</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="in">mean_osc &lt;- means_tbl[[2,2]]</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="in">nsize &lt;- means_tbl[[1,3]]</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="in">mse &lt;- summary(brush_aov)[[1]][2,3] #This gets the number from the summary table</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="in">tstat &lt;- (mean_man - mean_osc)/sqrt(mse*(1/nsize + 1/nsize))</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="in">pprob &lt;- pt(q=tstat, df=brush_aov$df.resid, lower.tail=FALSE) * 2</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-brush_analysis" class="quarto-layout-panel anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-brush_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Toothbrush Experiment Results
</figcaption>
<div aria-describedby="tbl-brush_analysis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="tbl-brush_analysis" style="flex-basis: 50.0%;justify-content: center;">
<div id="tbl-brush_analysis-1" class="do-not-create-environment quarto-float anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-brush_analysis-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Factor Level Means
</figcaption>
<div aria-describedby="tbl-brush_analysis-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-brush_analysis-1" class="do-not-create-environment table">
<colgroup>
<col style="width: 19%">
<col style="width: 11%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Brush</th>
<th style="text-align: center;">mean</th>
<th style="text-align: center;">sample size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Manual</td>
<td style="text-align: center;">23.09</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td style="text-align: center;">Oscillating</td>
<td style="text-align: center;">19.98</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Sonic</td>
<td style="text-align: center;">22.67</td>
<td style="text-align: center;">6</td>
</tr>
<tr class="even">
<td style="text-align: center;">Ultrasonic</td>
<td style="text-align: center;">25.31</td>
<td style="text-align: center;">6</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="tbl-brush_analysis-2" class="do-not-create-environment quarto-float anchored">
<figure class="quarto-float quarto-subfloat-tbl figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-tbl" id="tbl-brush_analysis-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) ANOVA Summary Table
</figcaption>
<div aria-describedby="tbl-brush_analysis-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table id="tbl-brush_analysis-2" class="do-not-create-environment table">
<colgroup>
<col style="width: 22%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Df</th>
<th style="text-align: center;">Sum Sq</th>
<th style="text-align: center;">Mean Sq</th>
<th style="text-align: center;">F value</th>
<th style="text-align: center;">Pr(&gt;F)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Brush</strong></td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">86.31</td>
<td style="text-align: center;">28.77</td>
<td style="text-align: center;">3.822</td>
<td style="text-align: center;">0.02583</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Residuals</strong></td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">150.6</td>
<td style="text-align: center;">7.528</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<p>With that information we can proceed with our test of whether the mean of manual brushes is equal to the mean of oscillating brushes. Plugging the values from <a href="#tbl-brush_analysis" class="quarto-xref">Table&nbsp;3</a> into <a href="#eq-diff2means" class="quarto-xref">Equation&nbsp;1</a> we can calculate the t statistic:</p>
<p><span id="eq-tvalue"><span class="math display">\[
t = \frac{ 3.11 }{\sqrt{ 7.53 * (\frac{1}{ 6 } + \frac{1}{ 6 })}} = 1.97
\tag{3}\]</span></span></p>
<p>A t statistic of 1.97 with 20 degrees of freedom, leads to a p-value of 0.063(using a two-tailed alternative hypothesis of “not equal”). Since the p-value is greater than our traditional alpha of 0.05, we fail to reject the null hypothesis of equality. In other words, there is insufficient evidence to claim that the manual brush and the oscillating brush have different mean values for percent area of teeth with plaque.</p>
</section>
<section id="t-test-for-any-contrast" class="level3">
<h3 class="anchored" data-anchor-id="t-test-for-any-contrast">t-test for Any Contrast</h3>
<p>This same t-test approach can be extended so that we can test any contrast, not just pairwise comparisons. To extend the approach, recognize that the <span class="math inline">\(1's\)</span> in <a href="#eq-tvalue" class="quarto-xref">Equation&nbsp;3</a> appearing directly above each sample size actually represent the squared coefficient of the contrast (see <a href="#tbl-expanded" class="quarto-xref">Table&nbsp;1</a>). Thus, <a href="#eq-diff2means" class="quarto-xref">Equation&nbsp;1</a> used to compare two factor level means, is actually just a special case of a more general formula, <a href="#eq-contrast" class="quarto-xref">Equation&nbsp;4</a>, which allows us to perform a hypothesis test of any contrast. This equation continues with the general structure of a t statistic: the numerator contains a sample estimate of the difference, the denominator is the standard error of that difference.</p>
<p><span id="eq-contrast"><span class="math display">\[
t = \frac{\hat{\psi}}{s_\hat{\psi}} = \frac{\hat{\psi}}{\sqrt{MSE * \sum(c^2_i / n_i)}}
\tag{4}\]</span></span></p>
<p>Where,</p>
<ul>
<li><span class="math inline">\(\hat{\psi}\)</span> is an estimate of the contrast, obtained by multiplying each factor level mean by its respective contrast coefficient. For a simple pairwise comparison, it is just the difference in means.</li>
<li><span class="math inline">\(MSE\)</span> is the mean squares of residuals obtained from the ANOVA summary table</li>
<li><span class="math inline">\(c_i\)</span> is the contrast coefficient for the <span class="math inline">\(i^\text{th}\)</span> factor level and</li>
<li><span class="math inline">\(n_i\)</span> is the sample size of the <span class="math inline">\(i^\text{th}\)</span> factor level.</li>
</ul>
<p>The degrees of freedom for <span class="math inline">\(t\)</span> will be equal to the degrees of freedom for residual error in the ANOVA summary table.</p>
<p>Let’s use this more general approach in <a href="#eq-contrast" class="quarto-xref">Equation&nbsp;4</a> to test the fourth hypothesis contained in Table <a href="#tbl-expanded" class="quarto-xref">Table&nbsp;1</a>. Our alternative hypothesis will be the contrast is not equal to zero. Though you can use directional (i.e.&nbsp;1-tailed) tests of a contrast, the default is to use a two-tailed alternative hypothesis of “not equal to zero”.</p>
<p>Plugging the values from <a href="#tbl-brush_analysis" class="quarto-xref">Table&nbsp;3</a> into <a href="#eq-contrast" class="quarto-xref">Equation&nbsp;4</a> we can calculate the t statistic:</p>
<p>Numerator: <span class="math display">\[
\hat{\psi} = 1 * 23.09 + -\frac{1}{3} * 19.98 + -\frac{1}{3} * 22.67 + -\frac{1}{3} * 25.31 = 0.438
\]</span></p>
<p>Denominator: <span class="math display">\[
s_\hat{\psi} = \sqrt{MSE * \sum(c^2_j / n_j)} = \sqrt{ 7.53 * \left( \frac{1^2}{6} + \frac{-\frac{1}{3}^2}{6} + \frac{-\frac{1}{3}^2}{6} + \frac{-\frac{1}{3}^2}{6} \right) } = 1.294
\]</span></p>
<p>t statistic: <span id="eq-contrast4"><span class="math display">\[
t = \frac{\hat{\psi}}{s_\hat{\psi}} = \frac{0.438}{1.294} = .34
\tag{5}\]</span></span></p>
<p>A test statistic <span class="math inline">\(t_\text{20} = .34\)</span> is not large enough to be significant.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Actually, it does not make a lot of sense to compare the control group (manual brush) to the average of the other three brushes. For a contrast of the control mean vs.&nbsp;average of the treatments to make sense, the treatments would need to have more commonality. For example, if there were two treatments and both used oscillating toothbrushes: one oscillated in a clockwise fashion and the other oscillated in a counter-clockwise. In that case it would make sense to combine the treatment factor levels since they could be interpreted generally as “oscillating brush”. Then you could compare the average of the oscillating groups against the average of the control group (manual brush).</p>
</div>
</div>
</section>
<section id="f-test-vs.-t-test" class="level3">
<h3 class="anchored" data-anchor-id="f-test-vs.-t-test">F-test vs.&nbsp;t-test</h3>
<p>We could have reached exactly the same conclusions by conducting an appropriate F test for the contrast instead of a t-test<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. It can be shown that <span class="math inline">\(F = t^2\)</span>. When t is based on the degrees of freedom for residuals, and F has <span class="math inline">\(df_\text{numerator}\)</span> = 1 and <span class="math inline">\(df_\text{denominator} = df_\text{residuals}\)</span> , the two tests given identical p-values and thus lead to the same conclusion.</p>
</section>
<section id="r-instructions" class="level3">
<h3 class="anchored" data-anchor-id="r-instructions">R Instructions</h3>
<p>This section illustrates just one way to test <em>custom</em> contrasts in R. There are many packages, each with their unique syntax, for computing and testing contrasts. As you work more in the field, you may find another package better suits your needs.</p>
<p>There are sets of comparisons (a.k.a. contrasts) that are commonly done in practice. The calculation of these sets can be obtained with simpler code than what is shown here but may require other R packages. In addition, when testing multiple contrasts simultaneously there are potentially other adjustments that should be made. Please read “Multiple Comparisons” to understand what other adjustments to consider as well as the R code for conducting these common sets of comparisons.</p>
<script type="text/javascript">
 function showhide(id) {
    var e = document.getElementById(id);
    e.style.display = (e.style.display == 'block') ? 'none' : 'block';
 }
 
 function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
}
 
</script>
<p><strong>Caution</strong>, the <code>contrasts()</code> function from the <code>stats</code> package in base R will produce the correct p-value for the test of a contrast, but without extra work will not produce the correct estimate of the contrast itself. For this reason, we illustrate estimating and testing the contrast with the <code>emmeans</code> package, which stands for “estimated marginal means”.</p>
<p>The first step is to create the model. Then use the <code>emmeans()</code> command to create a grid of factor level summary statistics, including: means, standard deviations, standard error, degrees of freedom associated with the standard error estimate, and confidence intervals around the mean. Unlike a <code>summarize()</code> or <code>favstats()</code> command, <code>emmeans()</code> has the output structured so that it can easily be used in the next step. Store the grid of means into a new object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>myaov <span class="ot">&lt;-</span> <span class="fu">aov</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> df)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>mymeans <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(myaov, <span class="st">"X"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>myaov</code> is some name you come up with to store the results of the <code>aov()</code> model.</li>
<li><code>Y</code> must be a “numeric” vector of the quantitative response variable.</li>
<li><code>X</code> is a qualitative variable (should have class(X) equal to factor or character. If it does not, use <code>factor(X)</code> inside the <code>aov(Y ~ factor(X),...)</code> command.</li>
<li><code>df</code> is the name of your data set.</li>
<li><code>mymeans</code> is some name you come up with to store the results of the <code>emmeans()</code> command.</li>
</ul>
<p>Define the contrasts you are interested in testing inside the <code>contrast()</code> function, which returns the hypothesis test results. You can also feed the result into a <code>confint()</code> function if you prefer confidence intervals over p-values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(mymeans,<span class="fu">list</span>(<span class="at">name_of_contrast1 =</span> coefficient vector,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name_of_contrast2 =</span> another coefficient vector))<span class="er">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>name_of_contrast</code> are descriptive names you should give to the contrast to help you remember what it represents. The <code>coefficient vector</code> is how you define the contrast.</p>
<p>We will repeat the contrasts we did by hand in the sections above, but this time using R.</p>
<p><strong>Example Code Using Toothbrush Experiment:</strong></p>
<a href="javascript:showhide('contrast_brush')">
<div class="hoverchunk">
<p><span class="tooltipr"> df <span class="tooltiprtext">The name you want for your dataset</span> </span><span class="tooltipr"> &lt;- <span class="tooltiprtext">The assignment operator. The result to the right of it gets stored in an object specified on the left</span> </span><span class="tooltipr"> read_csv(“../data/toothpaste_BF2.csv”) <span class="tooltiprtext">A tidyverse command to read the data in from the specified path</span> </span><br><span class="tooltipr"> plaque_aov <span class="tooltiprtext">Name you want for your ANOVA model</span> </span><span class="tooltipr"> &lt;- <span class="tooltiprtext">The assignment operator. The result to the right of it gets stored in an object specified on the left</span> </span><span class="tooltipr"> aov( <span class="tooltiprtext">A function to define the model</span> </span><span class="tooltipr"> Plaque <span class="tooltiprtext">The response, or y, variable in the model. It is numeric.</span> </span><span class="tooltipr"> ~ <span class="tooltiprtext">The ~ is like an equal sign in the model. Items on the left of ~ represent y, on the right you define independent factors (i.e.&nbsp;x’s).</span> </span><span class="tooltipr"> Brush, <span class="tooltiprtext">The independent variable containing the names for the 4 types of toothbrushes.</span> </span><span class="tooltipr"> data = df <span class="tooltiprtext">Tell the model to look in the dataset named “df” for Plaque and Brush variables</span> </span><span class="tooltipr"> ) <span class="tooltiprtext">Functions always end with a closing parenthesis</span> </span><br><span class="tooltipr"> brush_means <span class="tooltiprtext">The name you want for the output of the emmeans command</span> </span><span class="tooltipr"> &lt;- <span class="tooltiprtext">The assignment operator. The result to the right of it gets stored in an object specified on the left</span> </span> <span class="tooltipr"> emmeans( <span class="tooltiprtext"> Function to calculate stats about marginal means </span></span><span class="tooltipr"> plaque_aov, <span class="tooltiprtext">aov model created in previous step</span> </span><span class="tooltipr"> “Brush” <span class="tooltiprtext">Factor for whose levels you want to calculate means</span> </span><span class="tooltipr"> ) <span class="tooltiprtext">Functions always end with a closing parenthesis</span> </span><br><span class="tooltipr"> contrast_results <span class="tooltiprtext">Name you want to store contrast results in</span> </span><span class="tooltipr"> &lt;- <span class="tooltiprtext">The assignment operator. The result to the right of it gets stored in an object specified on the left</span> </span><span class="tooltipr"> contrast( <span class="tooltiprtext">Function to define and test contrasts</span> </span><span class="tooltipr"> brush_means, <span class="tooltiprtext">Grid of stats about marginal means you named in the previous step</span></span><span class="tooltipr"> list( <span class="tooltiprtext">create a list object, which allows you to pass multiple contrast coefficient vectors</span> </span><span class="tooltipr"> man_v_osc = <span class="tooltiprtext">A descriptive name to help you remember what the contrast represents</span> </span><span class="tooltipr"> c(1,-1,0,0) <span class="tooltiprtext">Vector of coefficients used to define the contrast</span> </span><span class="tooltipr"> , <span class="tooltiprtext">Seperator to allow additional inputs to the list</span> </span><br><span class="tooltipr"> &nbsp;&nbsp;&nbsp;man_v_others = <span class="tooltiprtext">A descriptive name to help you remember what the contrast represents</span> </span><span class="tooltipr"> c(1,-(1/3),-(1/3),-(1/3)) <span class="tooltiprtext">Vector of coefficients used to define the contrast</span> </span><span class="tooltipr"> ), <span class="tooltiprtext">A list is closed with a parenthesis</span> </span><span class="tooltipr"> adjust = <span class="tooltiprtext">Specify what type of adjustment (if any) to make for multiple testing. Default is “none” if this argument is not included.</span> </span><span class="tooltipr"> “none” <span class="tooltiprtext">Read help at ?summary.emmGrid for other acceptable values</span> </span><span class="tooltipr"> ) <span class="tooltiprtext">Functions always end with a closing parenthesis</span> </span><br><span class="tooltipr"> contrast_results <span class="tooltiprtext">View the test results stored in this object in the previous step</span> </span><br><span class="tooltipr"> confint( <span class="tooltiprtext">Function to create confidence intervals around contrasts</span> </span><span class="tooltipr"> contrast_results <span class="tooltiprtext">Name of object where you stored contrasts</span> </span><span class="tooltipr"> ) <span class="tooltiprtext">Functions always end with a closing parenthesis</span> </span><br><span class="tooltipr" style="float:right;"> Toggle output <span class="tooltiprtext">Toggle Output.</span> </span></p>
</div>
</a>
<div id="contrast_brush" style="display:show;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> contrast     estimate   SE df t.ratio p.value
 man_v_osc       3.117 1.58 20   1.967  0.0632
 man_v_others    0.438 1.29 20   0.339  0.7382</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> contrast     estimate   SE df lower.CL upper.CL
 man_v_osc       3.117 1.58 20   -0.188     6.42
 man_v_others    0.438 1.29 20   -2.260     3.14

Confidence level used: 0.95 </code></pre>
</div>
</div>
</div>
</section>
</section>
<section id="othogonal-contrasts" class="level2">
<h2 class="anchored" data-anchor-id="othogonal-contrasts">Othogonal Contrasts</h2>
<p>In ANOVA, the variability in a dataset is decomposed, or allocated, to the various factors contributing to that variance. This total variability is called Sums of Squares. The Sums of Squares for a particular factor can further be decomposed, or allocated. Most of the time the variability is allocated to simple contrasts (i.e.&nbsp;a comparison of factor level means). Sometimes however, there is a desire to create a more complex contrast as we have seen above. When two contrasts do not share any information, or have any overlap in how their sums of squares are calculated, they are said to be orthogonal. Stated another way, the variability in one contrast is not correlated with the variability in another. This means that the information gained from one contrast is completely independent of the information gained in another, orthogonal contrast.</p>
<p>You can use a set of orthogonal contrasts to split the Sums of Squares for a factor into pieces, one piece for each contrast. There is a limit to how many contrasts can be tested for a given factor. That limit is the factor’s degrees of freedom. Testing sets of non-orthogonal contrasts can effect your Type I family error rate because the information contained in the contrasts is not independent.</p>
<section id="assess-orthogonality" class="level3">
<h3 class="anchored" data-anchor-id="assess-orthogonality">Assess Orthogonality</h3>
<p>Two contrasts are orthogonal if the dot product of the coefficient vectors equals zero. The term “dot product” means that corresponding elements of a vector are multiplied, and then those products are summed together.</p>
<p>Let’s determine if the contrasts listed in <a href="#tbl-coefficients" class="quarto-xref">Table&nbsp;2</a> are orthogonal to one another. On the right hand side of <a href="#tbl-coefficients" class="quarto-xref">Table&nbsp;2</a> the coefficient vector of the contrast is listed. We will investigate 2 of the 6 pairs of contrasts.</p>
<p>First, we will assess whether the contrast <span class="math inline">\(\mu_{osc} - \mu_{man}\)</span> is orthogonal to <span class="math inline">\(\mu_{sonic}- \mu_{ultra}\)</span>.</p>
<div id="tbl-first_pair" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-first_pair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: First Pair of Contrasts Showing Orthogonal Contrasts
</figcaption>
<div aria-describedby="tbl-first_pair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Contrast</th>
<th style="text-align: center;">Set of Contrast Coefficients</th>
<th style="text-align: center;">man. coef.</th>
<th style="text-align: center;">osc. coef.</th>
<th style="text-align: center;">sonic coef.</th>
<th style="text-align: center;">ultra coef.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \mu_\text{man} \end{aligned}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\{ -1, 1, 0, 0 \}\)</span></td>
<td style="text-align: center;">-1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\begin{aligned}\mu_\text{sonic} - \mu_\text{ultra} \end{aligned}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\{ 0, 0, 1, -1 \}\)</span></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>Product of Coefficients</strong></td>
<td style="text-align: center;"><span class="math inline">\(-1 \times 0 = 0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1 \times 0 = 0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0 \times 1 = 0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0 \times -1 = 0\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>In the last row of <a href="#tbl-first_pair" class="quarto-xref">Table&nbsp;4</a>, the product of the elements of the coefficient vectors are calculated. The sum of these products <span class="math inline">\(0 + 0 + 0 + 0 = 0\)</span>. Because the sum of the products is zero, we conclude the first two contrasts listed in <a href="#tbl-coefficients" class="quarto-xref">Table&nbsp;2</a> are orthogonal.</p>
<p>Next, we will assess whether the contrast <span class="math inline">\(\mu_{osc} - \mu_{man}\)</span> is orthogonal to <span class="math inline">\(\mu_{osc}- \frac{\mu_{sonic} + \mu_{ultra}}{2}\)</span>.</p>
<div id="tbl-second_pair" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-second_pair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Comparing a Different Set of Contrasts that Are NOT Orthogonal Contrasts
</figcaption>
<div aria-describedby="tbl-second_pair-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Contrast</th>
<th style="text-align: center;">Set of Contrast Coefficients</th>
<th style="text-align: center;">man. coef.</th>
<th style="text-align: center;">osc. coef.</th>
<th style="text-align: center;">sonic coef.</th>
<th style="text-align: center;">ultra coef.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \mu_\text{man} \end{aligned}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\{ -1, 1, 0, 0 \}\)</span></td>
<td style="text-align: center;">-1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;"><span class="math inline">\(\begin{aligned}\mu_{osc}- \frac{\mu_{sonic} + \mu_{ultra}}{2} \end{aligned}\)</span></td>
<td style="text-align: center;">{ 0, 1, <span class="math inline">\(-\frac{1}{2}\)</span>, <span class="math inline">\(-\frac{1}{2}\)</span> }</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><span class="math inline">\(-\frac{1}{2}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(-\frac{1}{2}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>Product of Coefficients</strong></td>
<td style="text-align: center;"><span class="math inline">\(-1 \times 0 = 0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(1 \times 1 = 1\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0 \times -\frac{1}{2} = 0\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0 \times -\frac{1}{2} = 0\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>In <a href="#tbl-second_pair" class="quarto-xref">Table&nbsp;5</a> the product of the elements of the coefficient vectors are calculated in the last row. The sum of these products is <span class="math inline">\(0 + 1 + 0 + 0 = 1\)</span>. Because the sum of the products is NOT zero, we conclude that these two contrasts are NOT orthogonal.</p>
<p>It has been shown how to determine orthogonality for the contrasts contained in first two rows of <a href="#tbl-ortho" class="quarto-xref">Table&nbsp;6</a> below. The orthogonality of the other contrast pairs is left to the reader to work through. However, the answers are displayed so that you may check your work.</p>
<div id="tbl-ortho" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ortho-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Orthogonality of Contrasts from <a href="#tbl-coefficients" class="quarto-xref">Table&nbsp;2</a>
</figcaption>
<div aria-describedby="tbl-ortho-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 36%">
<col style="width: 43%">
<col style="width: 19%">
</colgroup>
<thead>
<tr class="header">
<th>Contrast Row #’s from <a href="#tbl-coefficients" class="quarto-xref">Table&nbsp;2</a></th>
<th></th>
<th>Orthogonality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \mu_\text{man}\end{aligned}\)</span></td>
<td><span class="math inline">\(\begin{aligned}\mu_\text{sonic} - \mu_\text{ultra}\end{aligned}\)</span></td>
<td>orthogonal</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \mu_\text{man}\end{aligned}\)</span></td>
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \frac{\mu_\text{sonic} + \mu_\text{ultra}}{2} \end{aligned}\)</span></td>
<td>not orthogonal</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \mu_\text{man}\end{aligned}\)</span></td>
<td><span class="math inline">\(\begin{aligned}\mu_\text{man} - \frac{\mu_\text{osc} + \mu_\text{sonic} + \mu_\text{ultra}}{3}\end{aligned}\)</span></td>
<td>not orthogonal</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\begin{aligned}\mu_\text{sonic} - \mu_\text{ultra}\end{aligned}\)</span></td>
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \frac{\mu_\text{sonic} + \mu_\text{ultra}}{2} \end{aligned}\)</span></td>
<td>orthogonal</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\begin{aligned}\mu_\text{sonic} - \mu_\text{ultra}\end{aligned}\)</span></td>
<td><span class="math inline">\(\begin{aligned}\mu_\text{man} - \frac{\mu_\text{osc} + \mu_\text{sonic} + \mu_\text{ultra}}{3}\end{aligned}\)</span></td>
<td>orthogonal</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\begin{aligned}\mu_\text{osc} - \frac{\mu_\text{sonic} + \mu_\text{ultra}}{2} \end{aligned}\)</span></td>
<td><span class="math inline">\(\begin{aligned}\mu_\text{man} - \frac{\mu_\text{osc} + \mu_\text{sonic} + \mu_\text{ultra}}{3}\end{aligned}\)</span></td>
<td>not orthogonal</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>t-tests of pairwise comparisons with non-constant variance would result in the independent samples t-test presented in Math221 and Math325. More complicated contrasts assuming non-constant variance is explained in <em>Design and Analysis: A Researcher’s Handbook</em> by Keppel, G. and Wickens T.D. (2004, Pearson), starting on page 156.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The appropriate F-test consists of calculating the mean squares of the contrast and dividing by the mean squared error. In most cases, the contrast has 1 degree of freedom, so the contrast sum of squares is equal to the contrast mean squares. The formula to calculate a contrast sum of squares is</p>
<p><span class="math display">\[
SS_{\psi} = \frac{n*\hat{\psi}^2}{\sum{c_j^2}}
\]</span></p>
<p>The contrast has just 1 degree of freedom because it compares just two sets of observations. This is true even for complex comparisons: each set of observations may come from one factor level, or from a combination of factor levels.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>